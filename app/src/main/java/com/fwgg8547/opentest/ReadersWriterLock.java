package com.fwgg8547.opentest;

public final class ReadersWriterLock
{
	private int mReadingReaders = 0;
	private int mWaitingWriters = 0;
	private int mWritingWriter = 0;
	private boolean mPreferWriter = true;
	
	public synchronized void readLock() throws InterruptedException
	{
		if(mWritingWriter > 0 || (mPreferWriter && mWaitingWriters > 0)){
			wait();
		}
		
		mReadingReaders++;
	}
	
	public synchronized void readUnlock(){
		mReadingReaders--;
		mPreferWriter = true;
		notifyAll();
	}
	
	public synchronized void writeLock() throws InterruptedException
	{
		mWaitingWriters++;
		try {
			if(mReadingReaders > 0 || mWritingWriter > 0){
				wait();
			}
		} finally {
			mWaitingWriters--;
		}
		
		mWritingWriter++;
	}
	
	public synchronized void writeUnlock()
	{
		mWritingWriter--;
		mPreferWriter = false;
		notifyAll();
	}
}
