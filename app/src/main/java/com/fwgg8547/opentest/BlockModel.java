package com.fwgg8547.opentest;

import java.util.List;
import java.util.ArrayList;
import java.util.*;

public class BlockModel
{
	private static BlockModel instance;
	private static final int BLOCKNUM = 1;
	private static final int SCREENHIGHT = 2000;
	public class Item {
		public int mId;
		public Sprite mSprite;
	}

	private List<Item> mBlocks;

	public static BlockModel getInstance(){
		if(instance == null){
			instance = new BlockModel();
		}

		return instance;
	}

	private BlockModel(){
		mBlocks = new ArrayList<Item>();
	}
	
	public void initialize(int num){
		for(int i=0; i<num; i++){
			Sprite s = new Sprite(i);
			Item it = new Item();
			it.mId = i;
			it.mSprite = s;
			mBlocks.add(it);
		}
	}
	
	public float[] getBlockVert(int length){
		int i = 1;
		float[] vert = null;
		Iterator ite = mBlocks.iterator();
		while(ite.hasNext()){
			Item it =(Item)ite.next();
			if(vert == null) {
				vert = it.mSprite.getTransformedVertices();
			} else {
				vert = floatArrayConcat(vert, it.mSprite.getTransformedVertices());
			}
			if(i >= length){
				break;
			} else {
				i++;
			}
		}
		return vert;
	}

	public short[] getBlockIndex(int length){
		int i = 0;
		short[] index = null;
		Iterator ite = mBlocks.iterator();
		while(ite.hasNext()){
			Item it =(Item)ite.next();
			if(index == null) {
				index = it.mSprite.getIndices(i);
			} else {
				index = shortArrayConcat(index, it.mSprite.getIndices(i));
			}

			if(i+1 >= length){
				break;
			} else {
				i++;
			}
		}
		return index;
	}
	
	public float[] getUvs(){
		float[] def = new float[] {
      0.0f, 0.0f, 0.0f, 1.0f, 1.0f, 1.0f, 1.0f, 0.0f
		};
		
		float[] ux = null;
		for(int i=0; i<mBlocks.size();i++){
			
			if(ux == null){
				ux = def;
			} else {
				ux = floatArrayConcat(ux, def);
			}

		}
			
		return ux;
	}
	
	private float[] floatArrayConcat(float[] a, float[] b){
		float res[] = new float[a.length + b.length];
		System.arraycopy(a, 0, res, 0, a.length);
		System.arraycopy(b, 0, res, a.length, b.length);
		return res;
	}

	private short[] shortArrayConcat(short[] a, short[] b){
		short res[] = new short[a.length + b.length];
		System.arraycopy(a, 0, res, 0, a.length);
		System.arraycopy(b, 0, res, a.length, b.length);
		return res;
	}
	
	
}
